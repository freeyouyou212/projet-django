{% extends "base.html" %}
{% block title %}{{ offer.title }} — Détail de l'offre{% endblock %}

{% block content %}
<div class="mb-3">
  <a href="{% url 'offers:offer_list' %}" class="btn btn-link">&larr; Retour à la liste</a>
</div>

<div class="card">
  <div class="card-body">
    <h1 class="h4">{{ offer.title }}</h1>
    <h2 class="h6 text-muted mb-3">{{ offer.organization }}</h2>

    <p class="mb-1"><strong>Contact :</strong> {{ offer.contact_name }} ({{ offer.contact_email }})</p>
    <p class="mb-1"><strong>Déposée le :</strong> {{ offer.submission_date|date:"d/m/Y H:i" }}</p>
    <p class="mb-3">
      <strong>Statut :</strong>
      <span class="badge bg-secondary">{{ offer.get_status_display }}</span>
      <span class="badge bg-info text-dark">{{ applications_count }} candidature(s)</span>
    </p>

    <h5>Détails du stage</h5>
    <p>{{ offer.details|linebreaks }}</p>

    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}

    <!-- ============================================== -->
    <!--         BOUTONS POUR LE RESPONSABLE / ADMIN     -->
    <!-- ============================================== -->

    {% if user.is_authenticated and user.is_staff %}
      <hr>
      <h5>Actions responsable / admin</h5>
      <p>
        Statut actuel :
        <span class="badge bg-secondary">{{ offer.get_status_display }}</span>
      </p>

      <div class="btn-group" role="group">
        <a href="{% url 'offers:offer_set_status' offer.pk 'validated' %}"
           class="btn btn-outline-success btn-sm">
          Valider
        </a>

        <a href="{% url 'offers:offer_set_status' offer.pk 'rejected' %}"
           class="btn btn-outline-danger btn-sm">
          Refuser
        </a>

        <a href="{% url 'offers:offer_set_status' offer.pk 'closed' %}"
           class="btn btn-outline-secondary btn-sm">
          Clôturer
        </a>
      </div>

      <p class="mt-2">
        <a href="{% url 'offers:offer_pending_list' %}">← Retour aux offres en attente</a>
      </p>
    {% endif %}

    <!-- ============================================== -->
    <!--         PARTIE POUR LES ETUDIANTS (CANDIDATURE) -->
    <!-- ============================================== -->

    {% if user.is_authenticated and not user.is_staff %}
      {% if can_apply %}
        <a href="{% url 'offers:offer_apply' offer.pk %}" class="btn btn-success mt-3">
          Candidater à cette offre
        </a>
      {% else %}
        <p class="mt-3 text-muted">
          Cette offre n'est plus ouverte aux candidatures.
        </p>
      {% endif %}
    {% endif %}

    {% if not user.is_authenticated and can_apply %}
      <p class="mt-3">
        <a href="{% url 'accounts:login' %}?next={% url 'offers:offer_apply' offer.pk %}">
          Connectez-vous pour candidater.
        </a>
      </p>
    {% endif %}
  </div>
</div>
{% endblock %}
